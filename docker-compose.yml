name: Stock-Research-Assistant
services:
  # 1. Snapshot Data Initialization Service
  init_snapshot:
    image: ghcr.io/akashdesarda/stock-research-platform/srp-snapshot-data:latest
    volumes:
      - ./config.toml:/tmp/config.toml
      - shared-data:/shared
    environment:
      FORCE_DECOMPRESSION: "false" # Force decompression only if required
    command: ["uv", "run", "/snapshot_data_decompress.py"]
    tty: true
  # 2. Stock Database API Service
  stockdb-api:
    build:
      context: ./stockdb
      dockerfile: Dockerfile
    image: ghcr.io/akashdesarda/stock-research-platform/srp-stockdb-api:latest
    ports:
      - "8000:8000"
    volumes:
      - shared-data:/shared
    environment:
      CONFIG_FILE: /shared/assets/config.toml
      DOCKER_CONTAINER: "true" # Explicit Docker environment flag
    depends_on:
      init_snapshot:
        condition: service_completed_successfully
    tty: true

volumes:
  shared-data:
    name: "sra-shared-data"
